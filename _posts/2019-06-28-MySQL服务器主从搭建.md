---
layout: post
title: MySQL服务器主从搭建
date: 2019-06-28 22:00:01 +0800
excerpt: 这篇博客简要介绍了如何在CentOS7搭建MySQL主从服务器
author: 霜月初六
img:  # Add image post (optional)
tags: [MySQL]
---

# MySQL服务器的主从搭建

### CentOS7上安装MySQL

安装教程可以参考这篇博文：https://www.jianshu.com/p/1dab9a4d0d5f



### MySQL主从配置

#### 确定ip地址

首先，确保已经开启三台装有MySQL的虚拟机，并且通过如下指令查看各台虚拟机的ip地址

```sh
ip addr
```

我的三台虚拟机的ip地址如下图所示

![2019-06-28_220246](E:\Personal Blog\MrXWTe.github.io\assets\img\2019-06-28_220246.png)

#### 分配ip地址

因此，我将三台机器分别设置为如下	

- 192.168.1.167	主机
- 192.168.1.160    从机
- 192.168.1.161    从机

#### 关闭防火墙

要确保MySQL端口开放，默认端口号是3306，学习过程中可以直接关闭防火墙

```shell
systemctl stop firewalld	# 适用CentOS7
service iptable stop		# CentOS7不能直接使用，具体度娘一下
```

#### 创建数据库

在三台机器上分别创建两个数据库，分别为`cool1`和`cool2`，字符编码为utf-8。（**如果MySQL版本是5.7.26的话，数据库名不用加引号**）

```mysql
drop database if exists cool1;
create database cool1 character set utf8 collate utf8_general_ci;
drop database if exists cool2;
create database cool2 character set utf8 collate utf8_general_ci;
```

#### 结点配置

首先在主机上配置，现在虚拟机中输入如下指令

```shell
vim /etc/my.ini
```

在my.ini中配置如下信息

```ini
#server-id给数据库服务的唯一标识
server-id=1

#log-bin设置此参数表示启用binlog功能，并指定路径名称
log-bin=/var/lib/mysql/mysql-bin

sync_binlog=0

#设置日志的过期天数
expire_logs_days=7

#指定需要同步的数据库
binlog-do-db=cool
binlog-do-db=cool2

#指定同步过程中需要忽略的数据库，以下忽略都是安装后自带的数据库，如果有其他的也可以指定
binlog-ignore-db=information_schema
binlog-ignore-db=sys
binlog-ignore-db=mysql
binlog-ignore-db=performance_schema
```

配置完成后，重启MySQL，配置生效

```shell
systemctl restart mysqld
```

赋予从库（192.168.1.160，192.168.1.161）读取日志的File权限以及REPLICATION SLAVE的权限

```mysql
grant FILE on *.* to 'root'@'192.168.1.160' identified by 'root';

```

