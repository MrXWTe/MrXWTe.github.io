---
layout: post
title: Docker学习笔记
date: 2019-07-29 14:43:24 +0800
excerpt: 这篇博客记录了Docker学习过程中的笔记
author: 霜月初六
img:  docker.png
tags: [Docker]
---

## Docker学习笔记

### Docker在CentOS7上的安装

#### 1、准备安装阶段

我们这里安装`Docker Engine - Community`，该版本是社区版（免费O(∩_∩)O）。我的Linux的版本是`CentOS Linux release 7.6.1810 (Core)`，官网上的原话是`you need a maintained version of CentOS 7. Archived versions aren’t supported or tested.(您需要CentOS 7的维护版本。不支持或测试存档版本。)`。

如果原来安装了docker，需要先卸载掉旧版本的docker，以及相关联的依赖。

```shell
sudo yum remove docker \
                docker-client \
                docker-client-latest \
                docker-common \
                docker-latest \
                docker-latest-logrotate \
                docker-logrotate \
                docker-engine
```

#### 2、安装dockerEC

在安装docker之前，需要先设置docker存储库（`Docker repository`），之后，可以从该仓库安装和更新docker。

##### 安装需要的包

`yum-utils`提供`yum-config-manager`实用程序，`devicemapper`存储驱动程序需要`device-mapper-persistent-data`和`lvm2`。

```shell
sudo yum install -y yum-utils \
device-mapper-persistent-data \
lvm2
```

然后执行下面的命令设置稳定的存储库

```shell
sudo yum-config-manager \
--add-repo \
https://download.docker.com/linux/centos/docker-ce.repo
```

##### 激活夜间或测试存储库（可选）

夜间/测试存储库包含在`docker.repo`文件中，但默认是关闭的。您可以在激活稳定存储库的同时激活他们。下面的命令是用来激活夜间存储库的。

```shell
sudo yum-config-manager --enable docker-ce-nightly	# 激活夜间存储库
sudo yum-config-manager --enable docker-ce-test		# 激活测试通道
sudo yum-config-manager --disable docker-ce-nightly	# 关闭夜间存储库
```

##### 安装DockerEC

- 您可以通过以下命令安装最近版本的`Docker Engine - Community`

```shell
sudo yum install docker-ce docker-ce-cli containerd.io
```

如果在安装的过程中提示您验证GPG key，您可以对比以下密钥：`060A 61C5 1B55 8A7F 742B 77AA C52F EB6B 621E 9F35`，如果相匹配的话，选择yes。如下图所示：

![2019-07-29_143553](E:\Personal Blog\MrXWTe.github.io\assets\img\2019-07-29_143553.png)

- 您还可以通过以下指令安装指定版本的docker：首先通过以下指令展示docker的版本。版本号展示如下：

```shell
yum list docker-ce --showduplicates | sort -r
```

```
docker-ce.x86_64  3:18.09.1-3.el7                     docker-ce-stable
docker-ce.x86_64  3:18.09.0-3.el7                     docker-ce-stable
docker-ce.x86_64  18.06.1.ce-3.el7                    docker-ce-stable
docker-ce.x86_64  18.06.0.ce-3.el7                    docker-ce-stable
```

然后通过如下指令安装docker

```shell
sudo yum install docker-ce-<VERSION_STRING> docker-ce-cli-<VERSION_STRING> containerd.io
```

其中的`VERSION_STRING`指的是版本号字符串。注意**不是上面列表展示的全部字符串**，字符串是`docker-ce`加上上面列表第二个字符串从`:`开始到`-`结束的中间的字符串。举个栗子：`docker-ce-18.09.0`。



至此，docker已经成功安装完成，但是还没有运行，已创建docker组，但未向该组添加任何用户。

### Docker的使用

#### 1、配置阿里云镜像加速

首先登录阿里云，在`容器镜像服务->镜像加速器中`有详细文档教您如何在不同操作系统中配置阿里云服务器，如下以CentOS为例（针对Docker客户端版本大于 1.10.0 的用户）：

```shell
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["您的加速器地址"]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
```

#### 2、docker运行hello world

```
[root@localhost docker]# docker run hello-world 	# 运行docker的主要命令
Unable to find image 'hello-world:latest' locally	# 表示无法找到该镜像
latest: Pulling from library/hello-world			# 从云端拉取该镜像
1b930d010525: Pull complete 						# 拉取成功
Digest: sha256:6540fc08ee6e6b7b63468dc3317e3303aae178cb8a45ed3123180328bcc1d20f
Status: Downloaded newer image for hello-world:latest
# 显示如下文本表示docker成功运行
Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
```

运行`docker run ---` 后经过了以下几步

![2019-07-29_160001](E:\Personal Blog\MrXWTe.github.io\assets\img\2019-07-29_160001.png)

#### 3、docker帮助常用命令

```shell
docker version	# 查看版本信息
docker info		# 展示docker信息
docker help		# 帮助信息
```

#### 4、docker镜像常用命令

`docker images`

```shell
docker images	# 列出本地主机镜像
	-a			# 列出本地所有镜像（包含中间映像层）
	-q			# 只显示镜像ID
	--digests	# 显示镜像的摘要信息
	--no-trunc	# 显示完整的镜像信息
```

`docker search`

```shell
docker search [options] image-name	# 展示镜像名，从https://hub.docker.com查找
	--no-trunc	# 显示完整的镜像信息
	-s num		# 列出收藏数不小于num的镜像
	--automated	# 只列出automated build类型的镜像
```

`docker pull`

```shell
docker pull image-name:TAG	# 下载指定TAG的镜像，如果不指定TAG，则下载latest标签的镜像
```

`docker rmi`

```shell
docker rmi image-ID							# 删除镜像
docker rmi -f image-ID						# 强制删除单个镜像
docker rmi -f image-ID:TAG1 image-ID:TAG2	# 强制删除多个镜像
docker rmi -f $(docker images -qa)			# 删除全部镜像
```

#### 5、docker容器常用命令

`docker run`

```shell
docker run [options] image [command] [args...]
	--name="image-new-name"		# 为容器指定一个新名字
    -d							# 后台运行容器，并返回容器ID，即启动守护式容器
    -i							# 以交互模式运行容器，通产与-t使用
    -t							# 为容器重新分配一个输入中断，通常与-i使用
    -P							# 随机端口映射
    -p							# 指定端口映射
    [command]					# 如果没有指定默认为 /bin/bash
```

有两种常用运行方式：

- 交互式运行：`docker run -it centos`。此时，将由宿主机命令行跳转到容器命令行下，可以在容器中执行相关操作。一般centos可以交互式运行。由下图可以看出，以`-it`运行后，命令行由宿主机`localhost`跳转到了`daa6533349c2`。然后可以看出centos容器正在运行中。运行ID和主机ID相一致

![2019-07-29_175255](E:\Personal Blog\MrXWTe.github.io\assets\img\2019-07-29_175255.png)

![2019-07-29_175311](E:\Personal Blog\MrXWTe.github.io\assets\img\2019-07-29_175311.png)

- 后台运行：一般tomcat、nginx等可以在后台运行，因为完成了相关配置后无需对其做操作。

`docker ps`

```shell
docker ps [options]				# 列出所有正在运行的容器
	-a							# 列出正在运行+历史上运行的容器
	-l							# 显示最近创建的容器
	-n							# 显示最近创建的n个容器
	-q							# 只显示容器编号
	--no-trunc					# 不截断输出
```

`退出容器`

```shell
exit		# 容器停止退出
ctrl+p+q	# 容器不停止退出
```

`docker start 容器ID或容器名`

```shell
docker start daa6533349c2		# 启动容器
```

`docker restart 容器ID或容器名`

```shell
docker restart daa6533349c2		# 重启容器
```

`docker stop`

```shell
docker stop daa6533349c2		# 停止容器
```

`docker kill`

```shell
docker kill daa6533349c2		# 强制停止容器
```

`docker rm`

```shell
docker rm daa6533349c2			# 删除容器
docker rm $(docker ps -qa)		# 删除所有容器
docker ps -qa | xargs docker rm	# 删除所有容器
```











> 本文首发于我的个人网站【[https://mrxwte.github.io](https://mrxwte.github.io/)】，转载请注明出处。







